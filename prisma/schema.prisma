generator client {
  provider = "prisma-client"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

// Links a Supabase user to their AzerothCore game account
// The actual game account lives in AzerothCore's MySQL database
// This just tracks the relationship and username
model GameAccount {
  id             String   @id @default(cuid())
  supabaseUserId String   @unique @map("supabase_user_id")
  gameUsername   String   @unique @map("game_username") @db.VarChar(17)
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  @@map("game_accounts")
}

// Content types for the site
enum ContentType {
  release // Major update showcases
  blog    // Development updates, announcements
  wiki    // Feature documentation, guides
}

// Content managed by admin panel, displayed on public site
model Content {
  id            String      @id @default(cuid())
  type          ContentType
  slug          String      @unique
  title         String
  summary       String?     @db.Text
  body          Json        // Tiptap JSON format
  featuredImage String?     @map("featured_image")
  published     Boolean     @default(false)
  publishedAt   DateTime?   @map("published_at")
  authorId      String?     @map("author_id") // Admin panel user ID (for reference)
  authorName    String?     @map("author_name") // Denormalized for display
  metadata      Json        @default("{}")
  createdAt     DateTime    @default(now()) @map("created_at")
  updatedAt     DateTime    @updatedAt @map("updated_at")

  @@index([type, published, publishedAt])
  @@index([published, publishedAt])
  @@map("content")
}